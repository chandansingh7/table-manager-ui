<mat-toolbar color="primary">Booking Dashboard</mat-toolbar>

<div class="container">

  <!-- New Reservation -->
  <mat-card class="panel">
    <h3>Book a Table</h3>

    <form [formGroup]="form" (ngSubmit)="book()">

      <mat-form-field appearance="outline" class="full">
        <mat-label>User</mat-label>
        <mat-select formControlName="userId">
          <mat-option *ngFor="let u of users$ | async" [value]="u.id">{{u.username}}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full">
        <mat-label>Table (available)</mat-label>
        <mat-select formControlName="tableId">
          <mat-option *ngFor="let t of tables$ | async" [value]="t.id">
            Table {{t.tableNumber}}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <div class="dt-row">
        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="pickerIn" formControlName="checkInDate">
          <mat-datepicker-toggle matSuffix [for]="pickerIn"></mat-datepicker-toggle>
          <mat-datepicker #pickerIn></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Time (HH:mm)</mat-label>
          <input matInput type="time" formControlName="inTime">
        </mat-form-field>
      </div>

      <div class="dt-row">
        <mat-form-field appearance="outline">
          <mat-label>Date</mat-label>
          <input matInput [matDatepicker]="pickerOut" formControlName="checkOutDate">
          <mat-datepicker-toggle matSuffix [for]="pickerOut"></mat-datepicker-toggle>
          <mat-datepicker #pickerOut></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Time (HH:mm)</mat-label>
          <input matInput type="time" formControlName="outTime">
        </mat-form-field>
      </div>

      <button mat-raised-button color="primary" class="full" type="submit">
        Book Table
      </button>
    </form>
  </mat-card>

  <!-- Active reservations -->
  <mat-card class="panel">
    <h3>Active</h3>
    <table mat-table [dataSource]="(active$  | async) ?? []">
      <ng-container matColumnDef="user">
        <th mat-header-cell *matHeaderCellDef>User</th>
        <td mat-cell *matCellDef="let r">{{r.userName}}</td>
      </ng-container>

      <ng-container matColumnDef="table">
        <th mat-header-cell *matHeaderCellDef>Table</th>
        <td mat-cell *matCellDef="let r">{{r.tableId}}</td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let r">
          <button mat-icon-button color="primary" (click)="checkIn(r.id)" [disabled]="r.isCheckedIn">
            <mat-icon>login</mat-icon>
          </button>
          <button mat-icon-button color="accent" (click)="checkOut(r.id)" [disabled]="r.isCheckedOut">
            <mat-icon>logout</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="cancel(r.id)">
            <mat-icon>close</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['user','table','actions']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['user','table','actions'];"></tr>
    </table>
  </mat-card>

  <!-- History -->
  <mat-card class="panel">
    <h3>History</h3>
    <table mat-table [dataSource]="(history$ | async) ?? []">
      <ng-container matColumnDef="user"><th mat-header-cell *matHeaderCellDef>User</th>
        <td mat-cell *matCellDef="let r">{{r.userName}}</td></ng-container>
      <ng-container matColumnDef="table"><th mat-header-cell *matHeaderCellDef>Table</th>
        <td mat-cell *matCellDef="let r">{{r.tableNumber}}</td></ng-container>
      <ng-container matColumnDef="status"><th mat-header-cell *matHeaderCellDef>Status</th>
        <td mat-cell *matCellDef="let r">{{r.reservationStatus}}</td></ng-container>
      <tr mat-header-row *matHeaderRowDef="['user','table','status']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['user','table','status'];"></tr>
    </table>
  </mat-card>

</div>
